components:
  - MachineControl:
      description: "Service component to controls the whole machine"
      commands:
        - SwitchOn
        - SwitchOff
        - GetState
        - IncreaseMotorSpeed
        - DecreaseMotorSpeed
        - FilamentMergerControl.FeedingRunning
        - FilamentMergerControl.FeedingStopped
        - FilamentMergerControl.ErrorOccurred
        - FilamentCoilControl.CoilRunning
        - FilamentCoilControl.CoilStopped
        - FilamentCoilControl.ErrorOccurred
      notifications:
        - Starting
        - Running
        - SwitchedOff
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SelfTestSucceeded
        - SelfTestFailed
        - StartingSucceeded
        - StartingFailed
        - RunningFailed
        - WaitForStarted
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - SelfTest
          - Starting
          - WaitingForStarted
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: SelfTest
            event: SwitchOnSucceeded
            action: runSelfTest
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: SelfTest
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: SelfTest
            next: Starting
            event: SelfTestSucceeded
            action: startMachine
          - state: Starting
            next: WaitingForStarted
            event: WaitForStarted
          - state: WaitingForStarted
            next: WaitingForStarted
            event: WaitForStarted
            action: waitForStarted
          - state: WaitingForStarted
            next: Running
            event: StartingSucceeded
          - state: WaitingForStarted
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: WaitingForStarted
            next: Error
            event: StartingFailed
            action: handleError
          - state: Starting
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: RunningFailed
            action: handleError
          - state: Starting
            next: Error
            event: StartingFailed
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: SelfTest
            next: Error
            event: SelfTestFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff


  - FilamentMergerControl:
      description: "Hardware service component to control the filament merger unit"
      commands:
        - SwitchOn
        - SwitchOff
        - StartFeeding
        - StopFeeding
        - GetState
        - GetTemperatures
        - IncreaseMotorSpeed
        - DecreaseMotorSpeed
        - FilamentPreHeater.TargetTemperatureReached
        - FilamentPreHeater.HeatingStopped
        - FilamentPreHeater.ErrorOccurred
        - FilamentMergerHeater.TargetTemperatureReached
        - FilamentMergerHeater.HeatingStopped
        - FilamentMergerHeater.ErrorOccurred
        - FilamentFeederMotor.StartMotorSucceeded
        - FilamentFeederMotor.StartMotorFailed
        - FilamentFeederMotor.ErrorOccurred
      notifications:
        - FeedingRunning
        - FeedingStopped
        - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - HeatingUpSucceeded
        - HeatingUpFailed
        - StartMotor
        - StartingMotorSucceeded
        - StartingMotorFailed
        - StopMotor
        - StopMotorSucceeded
        - StopMotorFailed
        - RunningFailed
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingUp
          - MotorStopped
          - StartingMotor
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: HeatingUp
            event: SwitchOnSucceeded
            action: heatingUp
          - state: HeatingUp
            next: MotorStopped
            event: HeatingUpSucceeded
          - state: HeatingUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MotorStopped
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MotorStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingMotor
            next: Running
            event: StartingMotorSucceeded
          - state: StartingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: MotorStopped
            event: StopMotor
            action: stopMotor
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingUp
            next: Error
            event: HeatingUpFailed
            action: handleError
          - state: StartingMotor
            next: Error
            event: StartingMotorFailed
            action: handleError
          - state: Running
            next: Error
            event: RunningFailed
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff


  - FilamentFeederMotor:
      description: "Hardware service component to control the feeder motor of the filament merger unit"
      commands:
        - SwitchOn
        - SwitchOff
        - GetState
        - StartMotor
        - StopMotor
        - SetMotorSpeed
      notifications:
        - StartMotorSucceeded
        - StartMotorFailed
        - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - StartMotor
        - StartMotorSucceeded
        - StartMotorFailed
        - RunMotorFailed
        - StopMotor
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Stopped
          - Starting
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Stopped
            event: SwitchOnSucceeded
          - state: Stopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Stopped
            next: Starting
            event: StartMotor
            action: startMotor
          - state: Starting
            next: Running
            event: StartMotorSucceeded
          - state: Starting
            next: Error
            event: StartMotorFailed
            action: startMotor
          - state: Running
            next: Stopped
            event: StopMotor
            action: stopMotor
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Running
            next: Error
            event: RunMotorFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff


  - FilamentPreHeater:
      description: "Hardware service component to control the pre-heater of the filament merger unit"
      commands:
        - SwitchOn
        - SwitchOff
        - GetTemperature
      notifications:
        - TargetTemperatureReached
        - HeatingStopped
        - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOff
        - SwitchOnFailed
        - SwitchOnSucceeded
        - TargetTemperatureReached
        - HeatingUpFailed
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingUp
          - Heating
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: HeatingUp
            event: SwitchOnSucceeded
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: HeatingUp
            next: Heating
            event: TargetTemperatureReached
          - state: HeatingUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingUp
            next: Error
            event: HeatingUpFailed
            action: handleError
          - state: Heating
            next: Heating
            event: TargetTemperatureReached
          - state: Heating
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Heating
            next: Error
            event: HeatingUpFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            handle: switchOff


  - FilamentMergerHeater:
      description: "Hardware service component to control the merger heater of the filament merger unit"
      using: FilamentPreHeater


  - FilamentCoilControl:
      description: "Service component to control the filament coil unit"
      commands:
        - SwitchOn
        - SwitchOff
        - StartCoil
        - StopCoil
        - GetState
        - IncreaseMotorSpeed
        - DecreaseMotorSpeed
        - FilamentTensionSensor.TensionTooLow
        - FilamentTensionSensor.TensionTooHigh
        - FilamentTensionSensor.ErrorOccurred
        - FilamentCoilMotor.StartMotorSucceeded
        - FilamentCoilMotor.StartMotorFailed
        - FilamentCoilMotor.ErrorOccurred
      notifications:
        - CoilRunning
        - CoilStopped
        - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - StartCoil
        - StartingCoilSucceeded
        - StartingCoilFailed
        - StopCoil
        - StopCoilSucceeded
        - StopCoilFailed
        - RunningFailed
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - CoilStopped
          - StartingCoil
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: CoilStopped
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: CoilStopped
            next: StartingCoil
            event: StartCoil
            action: startCoil
          - state: CoilStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingCoil
            next: Running
            event: StartingCoilSucceeded
          - state: StartingCoil
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: CoilStopped
            event: StopCoil
            action: stopCoil
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: RunningFailed
            action: handleError


  - FilamentCoilMotor:
      description: "Hardware service component controls the filament coil motor of the filament coil unit"
      using: FilamentFeederMotor


  - FilamentTensionSensor:
      description: "Hardware service component to control the strain sensor of the filament coil unit"
      commands:
        - SwitchOn
        - SwitchOff
      notifications:
        - TensionTooLow
        - TensionTooHigh
        - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - RunningFailed
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Running
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: RunningFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff

  - UserInterfaceControl:
      description: "Hardware service component to control the user interface of the filament coil unit"
      commands:
        - MachineControl.Starting
        - MachineControl.Running
        - MachineControl.SwitchedOff
      notifications:
        - UserSwitchOn
        - UserSwitchOff
        - UserIncreaseMotorSpeed
        - UserDecreaseMotorSpeed
      events:
        - SwitchOn
        - SwitchOff
        - StartingFinished
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Starting
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Starting
            event: SwitchOn
            action: switchOn
          - state: Starting
            next: Running
            event: StartingFinished
            action: switchRunning
          - state: Starting
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
