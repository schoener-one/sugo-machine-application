components:
  - MachineControl:
      description: "Service component to controls the whole machine"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - Start
          - StartHeatless
          - IncreaseMotorSpeed
          - DecreaseMotorSpeed
          - Stop
          - GetMotorSpeed
        notifications:
          - FilamentMergerControl.FeedingRunning
          - FilamentMergerControl.FeedingStopped
          - FilamentMergerControl.HeatedUp
          - FilamentMergerControl.ErrorOccurred
          - FilamentCoilControl.CoilRunning
          - FilamentCoilControl.CoilStopped
          - FilamentCoilControl.ErrorOccurred
      outbound:
        notifications:
          - Stopped
          - HeatingUp
          - Starting
          - Running
          - SwitchedOff
          - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - Start
        - StartHeatless
        - MergerHeatedUp
        - StartingSucceeded
        - Stop
        - StoppingSucceeded
        - CheckStartingState
        - CheckStoppingState
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Stopped
          - HeatingUp
          - Starting
          - Running
          - Stopping
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Initialization
            next: Stopped
            event: SwitchOnSucceeded
            action: notifyStopped
          - state: Stopped
            next: HeatingUp
            event: Start
            action: startHeating
          - state: Stopped
            next: Starting
            event: StartHeatless
            action: startMachine
          - state: Stopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingUp
            next: Starting
            event: MergerHeatedUp
            action: startMachine
          - state: HeatingUp
            next: Stopping
            event: Stop
            action: stopMachine
          - state: HeatingUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingUp
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Starting
            next: Starting
            event: CheckStartingState
            action: checkStartingState
          - state: Starting
            next: Running
            event: StartingSucceeded
          - state: Starting
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Starting
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Starting
            next: Stopping
            event: Stop
            action: stopMachine
          - state: Running
            next: Stopping
            event: Stop
            action: stopMachine
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Stopping
            next: Stopping
            event: CheckStoppingState
            action: checkStoppingState
          - state: Stopping
            next: Stopped
            event: StoppingSucceeded
          - state: Stopped
            next: Stopped
            event: CheckStoppingState
          - state: Stopping
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Stopping
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff

  - FilamentMergerControl:
      description: "Hardware service component to control the filament merger unit"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - StartFeeding
          - StopFeeding
          - GetTemperatures
          - SetMotorSpeed
          - StartHeating
        notifications:
          - FilamentPreHeater.TargetTemperatureRangeReached
          - FilamentPreHeater.ErrorOccurred
          - FilamentMergerHeater.TargetTemperatureRangeReached
          - FilamentMergerHeater.ErrorOccurred
          - FilamentFeederMotor.StartMotorSucceeded
          - FilamentFeederMotor.StopMotorSucceeded
          - FilamentFeederMotor.ErrorOccurred
      outbound:
        notifications:
          - FeedingRunning
          - FeedingStopped
          - HeatedUp
          - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - StartHeating
        - HeatingUpSucceeded
        - HeatingUpFailed
        - StartMotor
        - StartMotorSucceeded
        - StopMotorSucceeded
        - Stop
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingUp
          - HeatedUp
          - MergerStopped
          - StartingMotor
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: MergerStopped
            event: SwitchOnSucceeded
          - state: MergerStopped
            next: HeatingUp
            event: StartHeating
            action: heatingUp
          - state: HeatingUp
            next: HeatedUp
            event: HeatingUpSucceeded
            action: notifyHeatedUp
          - state: HeatingUp
            next: MergerStopped
            event: Stop
            action: stopMerger
          - state: HeatingUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatedUp
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MergerStopped
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MergerStopped
            next: MergerStopped
            event: Stop
          - state: HeatedUp
            next: MergerStopped
            event: Stop
            action: stopMerger
          - state: HeatedUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingMotor
            next: MergerStopped
            event: Stop
            action: stopMerger
          - state: HeatedUp
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: MergerStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MergerStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingMotor
            next: Running
            event: StartMotorSucceeded
            action: notifyRunning
          - state: StartingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: MergerStopped
            event: Stop
            action: stopMerger
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingUp
            next: Error
            event: HeatingUpFailed
            action: handleError
          - state: StartingMotor
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - _BaseMotor: &BaseMotor
      description: "Hardware service component to control a motor"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - StartMotor
          - StopMotor
          - SetMotorSpeed
      outbound:
        notifications:
          - StartMotorSucceeded
          - StopMotorSucceeded
          - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - StartMotor
        - StartMotorSucceeded
        - StopMotorSucceeded
        - ErrorOccurred
        - RunMotorFailed
        - StopMotor
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Stopped
          - Starting
          - Running
          - Stopping
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Stopped
            event: SwitchOnSucceeded
          - state: Stopped
            next: 'Off'
            event: SwitchOff
          - state: Stopped
            next: Stopped
            event: StopMotor
          - state: Stopped
            next: Starting
            event: StartMotor
            action: startMotor
          - state: Starting
            next: Running
            event: StartMotorSucceeded
          - state: Starting
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Running
            next: Stopping
            event: StopMotor
            action: stopMotor
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: stopMotor
          - state: Stopping
            next: Stopping
            event: StopMotor
          - state: Stopping
            next: Stopped
            event: StopMotorSucceeded
          - state: Stopping
            next: 'Off'
            event: SwitchOff
          - state: Stopping
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Running
            next: Error
            event: RunMotorFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
          - state: Error
            next: Error
            event: RunMotorFailed
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - FilamentFeederMotor:
      <<: *BaseMotor
      description: "Hardware service component to control the feeder motor of the filament merger unit"


  - _BaseHeater: &BaseHeater
      description: "Hardware service component to control a heater"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - GetTemperature
      outbound:
        notifications:
          - TargetTemperatureRangeReached
          - TargetTemperatureRangeLeft
          - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOff
        - SwitchOnFailed
        - SwitchOnSucceeded
        - MaxTemperatureReached
        - MinTemperatureReached
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingOn
          - HeatingOff
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: HeatingOn
            event: SwitchOnSucceeded
            action: startHeating
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOn
            next: HeatingOff
            event: MaxTemperatureReached
            action: stopHeating
          - state: HeatingOn
            next: HeatingOn
            event: MinTemperatureReached
          - state: HeatingOn
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOn
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: HeatingOff
            next: HeatingOff
            event: MaxTemperatureReached
          - state: HeatingOff
            next: HeatingOn
            event: MinTemperatureReached
            action: startHeating
          - state: HeatingOff
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOff
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            handle: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - FilamentPreHeater:
      <<: *BaseHeater
      description: "Hardware service component to control the pre-heater of the filament merger unit"

  - FilamentMergerHeater:
      <<: *BaseHeater
      description: "Hardware service component to control the merger heater of the filament merger unit"


  - FilamentCoilControl:
      description: "Service component to control the filament coil unit"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - StartCoil
          - StopCoil
          - SetMotorSpeed
        notifications:
          - FilamentTensionSensor.TensionTooLow
          - FilamentTensionSensor.TensionTooHigh
          - FilamentTensionSensor.TensionOverloaded
          - FilamentTensionSensor.ErrorOccurred
          - FilamentCoilMotor.StartMotorSucceeded
          - FilamentCoilMotor.StopMotorSucceeded
          - FilamentCoilMotor.ErrorOccurred
      outbound:
        notifications:
          - CoilRunning
          - CoilStopped
          - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - StartMotor
        - StartMotorSucceeded
        - StopMotor
        - StopMotorSucceeded
        - TensionTooLow
        - TensionTooHigh
        - TensionOverloaded
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - MotorStopped
          - StartingMotor
          - StoppingMotor
          - Running
          - Pausing
          - Paused
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: MotorStopped
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MotorStopped
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MotorStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MotorStopped
            next: MotorStopped
            event: StopMotor
          - state: StartingMotor
            next: MotorStopped
            event: StopMotor
            action: stopMotor
          - state: StartingMotor
            next: Running
            event: StartMotorSucceeded
            action: notifyRunning
          - state: StartingMotor
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: StartingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: StoppingMotor
            event: StopMotor
            action: stopMotor
          - state: StoppingMotor
            next: StoppingMotor
            event: StopMotor
          - state: StoppingMotor
            next: MotorStopped
            event: StopMotorSucceeded
          - state: StoppingMotor
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: StoppingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Running
            event: TensionTooHigh
            action: controlFilamentTension
          - state: Running
            next: Running
            event: TensionTooLow
            action: controlFilamentTension
          - state: Running
            next: Pausing
            event: TensionOverloaded
            action: stopMotor
          - state: Pausing
            next: Pausing
            event: TensionOverloaded
          - state: Pausing
            next: Paused
            event: StopMotorSucceeded
          - state: Pausing
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Pausing
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Paused
            next: Paused
            event: TensionOverloaded
          - state: Paused
            next: StartingMotor
            event: TensionTooHigh
            action: startMotor            
          - state: Paused
            next: 'Off'
            event: SwitchOff
            action: switchOff            
          - state: Paused
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Paused
            next: MotorStopped
            event: StopMotor
            action: stopMotor         
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - FilamentCoilMotor:
      <<: *BaseMotor
      description: "Hardware service component controls the filament coil motor of the filament coil unit"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - StartMotor
          - StopMotor
          - SetMotorSpeed
          - IncreaseMotorOffsetSpeed
          - DecreaseMotorOffsetSpeed


  - FilamentTensionSensor:
      description: "Hardware service component to control the strain sensor of the filament coil unit"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
      outbound:
        notifications:
          - TensionTooLow
          - TensionTooHigh
          - TensionOverloaded
          - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Running
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff

  - UserInterfaceControl:
      description: "Hardware service component to control the user interface of the filament coil unit"
      inbound:
        notifications:
          - MachineControl.Stopped
          - MachineControl.HeatingUp
          - MachineControl.Starting
          - MachineControl.Running
          - MachineControl.SwitchedOff
          - MachineControl.ErrorOccurred
      events:
        - MachineStopped
        - MachineHeatingUp
        - MachineStarting
        - MachineRunning
        - MachineSwitchedOff
        - MachineError
      statemachine:
        start: Active
        states:
          - Active
        transitions:
          - state: Active
            next: Active
            event: MachineStopped
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineHeatingUp
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineStarting
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineRunning
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineSwitchedOff
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineError
            action: handleMachineStateChange
