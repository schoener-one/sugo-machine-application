components:
  - MachineControl:
      description: "Service component to controls the whole machine"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - IncreaseMotorSpeed
          - DecreaseMotorSpeed
          - GetMotorSpeed
        notifications:
          - FilamentMergerControl.FeedingRunning
          - FilamentMergerControl.FeedingStopped
          - FilamentMergerControl.HeatedUp
          - FilamentMergerControl.ErrorOccurred
          - FilamentCoilControl.CoilRunning
          - FilamentCoilControl.CoilStopped
          - FilamentCoilControl.ErrorOccurred
      outbound:
        notifications:
          - Starting
          - Running
          - SwitchedOff
          - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - MergerHeatedUp
        - StartingSucceeded
        - StartingFailed
        - RunningStopped
        - ErrorOccurred
        - WaitForStarted
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - WaitingForHeatedUp
          - Starting
          - WaitingForStarted
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: WaitingForHeatedUp
            event: SwitchOnSucceeded
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: WaitingForHeatedUp
            next: Starting
            event: MergerHeatedUp
            action: startMachine
          - state: WaitingForHeatedUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Starting
            next: WaitingForStarted
            event: WaitForStarted
          - state: WaitingForStarted
            next: WaitingForStarted
            event: WaitForStarted
            action: waitForStarted
          - state: WaitingForStarted
            next: Running
            event: StartingSucceeded
          - state: WaitingForStarted
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: WaitingForStarted
            next: Error
            event: StartingFailed
            action: handleError
          - state: WaitingForStarted
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Starting
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Starting
            next: Error
            event: StartingFailed
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff

  - FilamentMergerControl:
      description: "Hardware service component to control the filament merger unit"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - StartFeeding
          - StopFeeding
          - GetTemperatures
          - SetMotorSpeed
        notifications:
          - FilamentPreHeater.TargetTemperatureRangeReached
          - FilamentPreHeater.ErrorOccurred
          - FilamentMergerHeater.TargetTemperatureRangeReached
          - FilamentMergerHeater.ErrorOccurred
          - FilamentFeederMotor.StartMotorSucceeded
          - FilamentFeederMotor.StartMotorFailed
          - FilamentFeederMotor.ErrorOccurred
      outbound:
        notifications:
          - FeedingRunning
          - FeedingStopped
          - HeatedUp
          - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - HeatingUpSucceeded
        - HeatingUpFailed
        - StartMotor
        - StartMotorSucceeded
        - StartMotorFailed
        - StopMotor
        - StopMotorSucceeded
        - StopMotorFailed
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingUp
          - MotorStopped
          - StartingMotor
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: HeatingUp
            event: SwitchOnSucceeded
            action: heatingUp
          - state: HeatingUp
            next: MotorStopped
            event: HeatingUpSucceeded
            action: notifyHeatedUp
          - state: HeatingUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MotorStopped
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MotorStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingMotor
            next: Running
            event: StartMotorSucceeded
            action: notifyRunning
          - state: StartingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: MotorStopped
            event: StopMotor
            action: stopMotor
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingUp
            next: Error
            event: HeatingUpFailed
            action: handleError
          - state: StartingMotor
            next: Error
            event: StartMotorFailed
            action: handleError
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - _BaseMotor: &BaseMotor
      description: "Hardware service component to control a motor"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - StartMotor
          - StopMotor
          - SetMotorSpeed
          - SetMotorOffsetSpeed
      outbound:
        notifications:
          - StartMotorSucceeded
          - StartMotorFailed
          - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - StartMotor
        - StartMotorSucceeded
        - StartMotorFailed
        - RunMotorFailed
        - StopMotor
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Stopped
          - Starting
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Stopped
            event: SwitchOnSucceeded
          - state: Stopped
            next: 'Off'
            event: SwitchOff
          - state: Stopped
            next: Starting
            event: StartMotor
            action: startMotor
          - state: Starting
            next: Running
            event: StartMotorSucceeded
          - state: Starting
            next: Error
            event: StartMotorFailed
            action: handleError
          - state: Running
            next: Stopped
            event: StopMotor
            action: stopMotor
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: stopMotor
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Running
            next: Error
            event: RunMotorFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
          - state: Error
            next: Error
            event: RunMotorFailed
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - FilamentFeederMotor:
      <<: *BaseMotor
      description: "Hardware service component to control the feeder motor of the filament merger unit"


  - _BaseHeater: &BaseHeater
      description: "Hardware service component to control a heater"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - GetTemperature
      outbound:
        notifications:
          - TargetTemperatureRangeReached
          - TargetTemperatureRangeLeft
          - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOff
        - SwitchOnFailed
        - SwitchOnSucceeded
        - MaxTemperatureReached
        - MinTemperatureReached
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingOn
          - HeatingOff
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: HeatingOn
            event: SwitchOnSucceeded
            action: startHeating
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOn
            next: HeatingOff
            event: MaxTemperatureReached
            action: stopHeating
          - state: HeatingOn
            next: HeatingOn
            event: MinTemperatureReached
          - state: HeatingOn
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOn
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: HeatingOff
            next: HeatingOff
            event: MaxTemperatureReached
          - state: HeatingOff
            next: HeatingOn
            event: MinTemperatureReached
            action: startHeating
          - state: HeatingOff
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOff
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            handle: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - FilamentPreHeater:
      <<: *BaseHeater
      description: "Hardware service component to control the pre-heater of the filament merger unit"

  - FilamentMergerHeater:
      <<: *BaseHeater
      description: "Hardware service component to control the merger heater of the filament merger unit"


  - FilamentCoilControl:
      description: "Service component to control the filament coil unit"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
          - StartCoil
          - StopCoil
          - SetMotorSpeed
        notifications:
          - FilamentTensionSensor.TensionTooLow
          - FilamentTensionSensor.TensionTooHigh
          - FilamentTensionSensor.ErrorOccurred
          - FilamentCoilMotor.StartMotorSucceeded
          - FilamentCoilMotor.StartMotorFailed
          - FilamentCoilMotor.ErrorOccurred
      outbound:
        notifications:
          - CoilRunning
          - CoilStopped
          - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - StartMotor
        - StartMotorSucceeded
        - StartMotorFailed
        - StopMotor
        - StopMotorSucceeded
        - StopMotorFailed
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - MotorStopped
          - StartingMotor
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: MotorStopped
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MotorStopped
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MotorStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingMotor
            next: Running
            event: StartMotorSucceeded
            action: notifyRunning
          - state: StartingMotor
            next: Error
            event: StartMotorFailed
            action: handleError
          - state: StartingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: MotorStopped
            event: StopMotor
            action: stopMotor
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff


  - FilamentCoilMotor:
      <<: *BaseMotor
      description: "Hardware service component controls the filament coil motor of the filament coil unit"


  - FilamentTensionSensor:
      description: "Hardware service component to control the strain sensor of the filament coil unit"
      inbound:
        commands:
          - SwitchOn
          - SwitchOff
      outbound:
        notifications:
          - TensionTooLow
          - TensionTooHigh
          - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Running
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Error
            next: Error
            event: ErrorOccurred
          - state: 'Off'
            next: 'Off'
            event: SwitchOff

  - UserInterfaceControl:
      description: "Hardware service component to control the user interface of the filament coil unit"
      inbound:
        notifications:
          - MachineControl.Starting
          - MachineControl.Running
          - MachineControl.SwitchedOff
          - MachineControl.ErrorOccurred
      events:
        - MachineStarting
        - MachineRunning
        - MachineSwitchedOff
        - MachineError
      statemachine:
        start: Active
        states:
          - Active
        transitions:
          - state: Active
            next: Active
            event: MachineStarting
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineRunning
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineSwitchedOff
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineError
            action: handleMachineStateChange
