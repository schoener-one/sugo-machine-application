components:
  - MachineControl:
      description: "Service component to controls the whole machine"
      commands:
        - SwitchOn
        - SwitchOff
        - IncreaseMotorSpeed
        - DecreaseMotorSpeed
        - GetMotorSpeed
        - FilamentMergerControl.FeedingRunning
        - FilamentMergerControl.FeedingStopped
        - FilamentMergerControl.HeatedUp
        - FilamentMergerControl.ErrorOccurred
        - FilamentCoilControl.CoilRunning
        - FilamentCoilControl.CoilStopped
        - FilamentCoilControl.ErrorOccurred
      notifications:
        - Starting
        - Running
        - SwitchedOff
        - Error
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SelfTestSucceeded
        - SelfTestFailed
        - MergerHeatedUp
        - StartingSucceeded
        - StartingFailed
        - RunningStopped
        - ErrorOccurred
        - WaitForStarted
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - SelfTest
          - WaitingForHeatedUp
          - Starting
          - WaitingForStarted
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: SelfTest
            event: SwitchOnSucceeded
            action: runSelfTest
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: SelfTest
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: SelfTest
            next: WaitingForHeatedUp
            event: SelfTestSucceeded
          - state: WaitingForHeatedUp
            next: Starting
            event: MergerHeatedUp
            action: startMachine
          - state: WaitingForHeatedUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Starting
            next: WaitingForStarted
            event: WaitForStarted
          - state: WaitingForStarted
            next: WaitingForStarted
            event: WaitForStarted
            action: waitForStarted
          - state: WaitingForStarted
            next: Running
            event: StartingSucceeded
          - state: WaitingForStarted
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: WaitingForStarted
            next: Error
            event: StartingFailed
            action: handleError
          - state: Starting
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Starting
            next: Error
            event: StartingFailed
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: SelfTest
            next: Error
            event: SelfTestFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff


  - FilamentMergerControl:
      description: "Hardware service component to control the filament merger unit"
      commands:
        - SwitchOn
        - SwitchOff
        - StartFeeding
        - StopFeeding
        - GetTemperatures
        - FilamentPreHeater.TargetTemperatureReached
        - FilamentPreHeater.ErrorOccurred
        - FilamentMergerHeater.TargetTemperatureReached
        - FilamentMergerHeater.ErrorOccurred
        - FilamentFeederMotor.StartMotorSucceeded
        - FilamentFeederMotor.StartMotorFailed
        - FilamentFeederMotor.ErrorOccurred
        - SetMotorSpeed
      notifications:
        - FeedingRunning
        - FeedingStopped
        - HeatedUp
        - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - HeatingUpSucceeded
        - HeatingUpFailed
        - StartMotor
        - StartMotorSucceeded
        - StartMotorFailed
        - StopMotor
        - StopMotorSucceeded
        - StopMotorFailed
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingUp
          - MotorStopped
          - StartingMotor
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: HeatingUp
            event: SwitchOnSucceeded
            action: heatingUp
          - state: HeatingUp
            next: MotorStopped
            event: HeatingUpSucceeded
            action: notifyHeatedUp
          - state: HeatingUp
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MotorStopped
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MotorStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingMotor
            next: Running
            event: StartMotorSucceeded
          - state: StartingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: MotorStopped
            event: StopMotor
            action: stopMotor
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingUp
            next: Error
            event: HeatingUpFailed
            action: handleError
          - state: StartingMotor
            next: Error
            event: StartMotorFailed
            action: handleError
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff


  - FilamentFeederMotor:
      description: "Hardware service component to control the feeder motor of the filament merger unit"
      commands:
        - SwitchOn
        - SwitchOff
        - StartMotor
        - StopMotor
        - SetMotorSpeed
        - SetMotorOffsetSpeed
      notifications:
        - StartMotorSucceeded
        - StartMotorFailed
        - ErrorOccurred
      events:
        - SwitchOff
        - SwitchOn
        - SwitchOnFailed
        - SwitchOnSucceeded
        - StartMotor
        - StartMotorSucceeded
        - StartMotorFailed
        - RunMotorFailed
        - StopMotor
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Stopped
          - Starting
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Stopped
            event: SwitchOnSucceeded
          - state: Stopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Stopped
            next: Starting
            event: StartMotor
            action: startMotor
          - state: Starting
            next: Running
            event: StartMotorSucceeded
          - state: Starting
            next: Error
            event: StartMotorFailed
            action: startMotor
          - state: Running
            next: Stopped
            event: StopMotor
            action: stopMotor
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Running
            next: Error
            event: RunMotorFailed
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff


  - FilamentPreHeater:
      description: "Hardware service component to control the pre-heater of the filament merger unit"
      commands:
        - SwitchOn
        - SwitchOff
        - GetTemperature
      notifications:
        - TargetTemperatureReached
        - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOff
        - SwitchOnFailed
        - SwitchOnSucceeded
        - MaxTemperatureReached
        - MinTemperatureReached
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - HeatingOn
          - HeatingOff
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: HeatingOn
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOn
            next: HeatingOff
            event: MaxTemperatureReached
            action: stopHeating
          - state: HeatingOn
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOn
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: HeatingOff
            next: HeatingOff
            event: MaxTemperatureReached
          - state: HeatingOff
            next: HeatingOn
            event: MinTemperatureReached
            action: startHeating
          - state: HeatingOff
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: HeatingOff
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            handle: switchOff


  - FilamentMergerHeater:
      description: "Hardware service component to control the merger heater of the filament merger unit"
      using: FilamentPreHeater


  - FilamentCoilControl:
      description: "Service component to control the filament coil unit"
      commands:
        - SwitchOn
        - SwitchOff
        - StartCoil
        - StopCoil
        - FilamentTensionSensor.TensionTooLow
        - FilamentTensionSensor.TensionTooHigh
        - FilamentTensionSensor.ErrorOccurred
        - FilamentCoilMotor.StartMotorSucceeded
        - FilamentCoilMotor.StartMotorFailed
        - FilamentCoilMotor.ErrorOccurred
        - SetMotorSpeed
      notifications:
        - CoilRunning
        - CoilStopped
        - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - StartMotor
        - StartMotorSucceeded
        - StartMotorFailed
        - StopMotor
        - StopMotorSucceeded
        - StopMotorFailed
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - MotorStopped
          - StartingMotor
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: MotorStopped
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: MotorStopped
            next: StartingMotor
            event: StartMotor
            action: startMotor
          - state: MotorStopped
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: StartingMotor
            next: Running
            event: StartMotorSucceeded
          - state: StartingMotor
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: MotorStopped
            event: StopMotor
            action: stopMotor
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError


  - FilamentCoilMotor:
      description: "Hardware service component controls the filament coil motor of the filament coil unit"
      using: FilamentFeederMotor


  - FilamentTensionSensor:
      description: "Hardware service component to control the strain sensor of the filament coil unit"
      commands:
        - SwitchOn
        - SwitchOff
      notifications:
        - TensionTooLow
        - TensionTooHigh
        - ErrorOccurred
      events:
        - SwitchOn
        - SwitchOnSucceeded
        - SwitchOnFailed
        - SwitchOff
        - ErrorOccurred
      statemachine:
        start: 'Off'
        states:
          - 'Off'
          - Initialization
          - Running
          - Error
        transitions:
          - state: 'Off'
            next: Initialization
            event: SwitchOn
            action: switchOn
          - state: Initialization
            next: Running
            event: SwitchOnSucceeded
          - state: Initialization
            next: Error
            event: SwitchOnFailed
            action: handleError
          - state: Initialization
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: 'Off'
            event: SwitchOff
            action: switchOff
          - state: Running
            next: Error
            event: ErrorOccurred
            action: handleError
          - state: Error
            next: 'Off'
            event: SwitchOff
            action: switchOff

  - UserInterfaceControl:
      description: "Hardware service component to control the user interface of the filament coil unit"
      commands:
        - MachineControl.Starting
        - MachineControl.Running
        - MachineControl.SwitchedOff
        - MachineControl.Error
      events:
        - MachineStarting
        - MachineRunning
        - MachineSwitchedOff
        - MachineError
      statemachine:
        start: Active
        states:
          - Active
        transitions:
          - state: Active
            next: Active
            event: MachineStarting
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineRunning
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineSwitchedOff
            action: handleMachineStateChange
          - state: Active
            next: Active
            event: MachineError
            action: handleMachineStateChange
